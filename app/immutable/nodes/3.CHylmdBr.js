import{t as c,a,c as ze,b as ne}from"../chunks/i3BjmpM2.js";import{h as Re,i as We,an as Ze,ao as Be,ap as Ge,b as He,t as Qe,a as Xe,c as Ye,a9 as et,Z as tt,a3 as G,a4 as Se,a5 as ie,O as at,$ as st,j as e,a0 as l,R as I,a7 as De,a2 as i,a1 as s,a6 as E,_ as J}from"../chunks/Ddu1Jl4_.js";import{d as rt,s as z}from"../chunks/ByWB01Zr.js";import{i as H}from"../chunks/B0eBhlmk.js";import{e as K,i as Te}from"../chunks/DOu1D6ee.js";import{R as ot,D as ve,C as Ie,I as Le,b as lt,T as Ne}from"../chunks/BnQun7ys.js";import{o as it}from"../chunks/CICj1xN9.js";import"../chunks/Q0CN05tj.js";import"../chunks/nbzItWDT.js";import{s as t,C as nt}from"../chunks/CwSdEVOQ.js";function _t(P,v,b){Re&&We();var Q=P,m=et,j,p=Ze()?Be:Ge;He(()=>{p(m,m=v())&&(j&&Qe(j),j=Xe(()=>b(Q)))}),Re&&(Q=Ye)}const ct="always",dt=!1,vt=!1,mt=!0;async function ft({url:P}){let v={};const b=P.searchParams.has("elfURLData"),Q=localStorage.getItem("lastOpenElfURL"),m=b?decodeURIComponent(P.searchParams.get("elfURLData")):Q;if(m){const L=await(await fetch(m)).json();localStorage.lastOpenElfURL=m,localStorage.elfStorageDate=new Date().toISOString(),v.symbols=L,console.log("Loaded elf data"),v.elfDataProvided=!0}else console.log("Loaded elf data",m,Object.keys(symbols.symbols).length);if(P.searchParams.has("selected_version")){const M=P.searchParams.get("selected_version");localStorage.selected_version=M,v.selected_version=M}else localStorage.getItem("selected_version")&&(v.selected_version=localStorage.getItem("selected_version"));if(P.searchParams.has("symbols.selected_versions_to_compare")){const M=P.searchParams.get("symbols.selected_versions_to_compare");localStorage.selected_versions_to_compare=M,v.selected_versions_to_compare=M}else localStorage.getItem("selected_versions_to_compare")&&(v.selected_versions_to_compare=localStorage.getItem("selected_versions_to_compare"));return v}const Bt=Object.freeze(Object.defineProperty({__proto__:null,csr:mt,load:ft,prerender:dt,ssr:vt,trailingSlash:ct},Symbol.toStringTag,{value:"Module"}));var pt=c("<option> </option>"),ut=c("Select a version of the .elf you want to see: <!>",1),yt=c("<option> </option>"),bt=c("Select a version of the .elf you want to compare against. <!>",1),ht=c("<!> <!>",1),kt=c('<label for="elfinput">Upload a puncover .json file:</label> <input accept="*/json" id="elfinput" name="elfinput" type="file">',1),gt=c("<h3>Select a version to browse elf symbols :)</h3>"),zt=c("<li>...<b> </b> </li>"),St=c("<h3>Thread stats</h3> <p> </p> <ul></ul>",1),xt=(P,v,b)=>e(v).toggleSort(e(b).id),$t=c('<span class="ml-2"><!></span>'),Pt=c('<th> <button class="flex items-center"><!></button></th>'),Ot=c("<td> </td>"),jt=c("<tr></tr>"),wt=c("<thead><tr></tr></thead> <tbody></tbody>",1),Rt=(P,v,b)=>e(v).toggleSort(e(b).id),Dt=c('<span class="ml-2"><!></span>'),Tt=c('<th> <button class="flex items-center"><!></button></th>'),It=c("<td> </td>"),Lt=c("<tr></tr>"),Nt=c("<thead><tr></tr></thead> <tbody></tbody>",1),Ut=c("<h3>Summary</h3> <p> </p> <ul><li> </li> <li> </li> <li> </li></ul> <!> <h3> </h3> <!> <h3> </h3> <!>",1),Ct=c('<div class="container" id="content"><!> <hr> <!></div>');function Gt(P,v){tt(v,!0),t.symbols=v.data.symbols,t.selected_version=v.data.selected_version,t.selected_versions_to_compare=v.data.selected_versions_to_compare,t.elfDataProvided=v.data.elfDataProvided;let b=G(void 0),Q=Se(()=>Object.keys(t.symbols)),m=G(ie({})),j=G(ie({})),p=G(ie({})),M=G(ie({})),L=G(ie({})),ce=G(ie([])),de=G(ie([])),V=Se(()=>new ve({pageSize:9999,data:e(ce),columns:[{id:"name",key:"display_name",name:"Name"},{id:"remark",key:"remark",name:"Remarks"},{id:"size",key:"size",name:"Code size"},{id:"d_size",key:"d_size",name:"Δ size"},{id:"stack_size",key:"stack_size",name:"Stack size"},{id:"d_stack",key:"d_stack",name:"Δ stack"}]})),F=Se(()=>new ve({pageSize:9999,data:e(de),columns:[{id:"name",key:"display_name",name:"Name"},{id:"remark",key:"remark",name:"Remarks"},{id:"size",key:"size",name:"Static size"},{id:"d_size",key:"d_size",name:"Δ size"}]})),xe=d=>{let u={};for(const y of d)y.remark="",y.newSymbols=!1,y.deletedSymbols=!1,y.d_size=null,y.d_stack=null,u[y.file+y.display_name]=y;return u},Ue=d=>Object.values(d).filter(u=>u.type==="function"),Ce=d=>Object.values(d).filter(u=>u.type==="variable"),$e=d=>new Set(Object.keys(d));const me=()=>{E(m,xe(t.symbols[t.selected_version].symbols),!0),E(p,xe(t.symbols[t.selected_versions_to_compare].symbols),!0),E(j,t.symbols[t.selected_version].stack_reports,!0),E(M,t.symbols[t.selected_versions_to_compare].stack_reports,!0);let d=$e(e(m)),u=$e(e(p)),y=Object.keys(Object.fromEntries(d.difference(u).entries())),X=Object.keys(Object.fromEntries(u.difference(d).entries()));E(L,{},!0);for(const r of X)e(p)[r].remark+="Deleted!",e(p)[r].size&&(e(p)[r].d_size=-e(p)[r].size),e(p)[r].stack_size&&(e(p)[r].d_stack=-e(p)[r].stack_size),e(L)[r]=e(p)[r];for(const r of Object.keys(e(m))){if(X.includes(r))continue;let N=!1;y.includes(r)?(e(m)[r].remark+="Newly added!",N=!0):(e(m)[r].size!=e(p)[r].size&&(e(m)[r].d_size=e(m)[r].size-e(p)[r].size,N=!0),e(m)[r].stack_size!=e(p)[r].stack_size&&(e(m)[r].d_stack=e(m)[r].stack_size-e(p)[r].stack_size,N=!0)),N&&(e(L)[r]=e(m)[r])}E(ce,Ue(e(L)),!0),E(de,Ce(e(L)),!0),E(V,new ve({pageSize:e(ce).length,data:e(ce),columns:[{id:"name",key:"display_name",name:"Name"},{id:"remark",key:"remark",name:"Remarks"},{id:"size",key:"size",name:"Code size"},{id:"d_size",key:"d_size",name:"Δ size"},{id:"stack_size",key:"stack_size",name:"Stack size"},{id:"d_stack",key:"d_stack",name:"Δ stack"}]}),!0),E(F,new ve({pageSize:e(de).length,data:e(de),columns:[{id:"name",key:"name",name:"Name"},{id:"remark",key:"remark",name:"Remarks"},{id:"size",key:"size",name:"Static size"},{id:"d_size",key:"d_size",name:"Δ size"}]}),!0)},Ee=()=>{localStorage.selected_version=t.selected_version,me()},Me=()=>{localStorage.selected_versions_to_compare=t.selected_versions_to_compare,me()};at(()=>{if(e(b)){console.log("files "+e(b));const d=e(b)[0];if(!d){console.log("No file selected. Please choose a file.","error");return}if(!(d.type.endsWith("JSON")||d.type.endsWith("json"))){console.log(d.type+"Unsupported file type. Please select a text file.","error");return}const u=new FileReader;u.onload=()=>{t.symbols=JSON.parse(u.result)},u.onerror=()=>{showMessage("Error reading the file. Please try again.","error")},u.readAsText(d)}}),it(async()=>{Object.keys(t.symbols).length==0?console.log("No ELF data URL passed or stored, please upload it as a file then :)"):t.selected_version&&t.selected_versions_to_compare?me():console.log("ELF loaded, please select which version to show :)")});var fe=Ct(),Pe=l(fe);ot(Pe,{children:(d,u)=>{var y=ht(),X=I(y);Ie(X,{children:(N,W)=>{De();var U=ut(),Y=i(I(U));Le(Y,{type:"select",get value(){return t.selected_version},set value(w){t.selected_version=w},$$events:{change:Ee},children:(w,Z)=>{var C=ze(),ee=I(C);K(ee,17,()=>e(Q),Te,(_e,S)=>{var h=pt(),te={},ae=l(h,!0);s(h),J(()=>{te!==(te=e(S))&&(h.value=(h.__value=e(S))==null?"":e(S)),z(ae,e(S))}),a(_e,h)}),a(w,C)},$$slots:{default:!0}}),a(N,U)},$$slots:{default:!0}});var r=i(X,2);Ie(r,{children:(N,W)=>{De();var U=bt(),Y=i(I(U));Le(Y,{type:"select",get value(){return t.selected_versions_to_compare},set value(w){t.selected_versions_to_compare=w},$$events:{change:Me},children:(w,Z)=>{var C=ze(),ee=I(C);K(ee,17,()=>e(Q),Te,(_e,S)=>{var h=yt(),te={},ae=l(h,!0);s(h),J(()=>{te!==(te=e(S))&&(h.value=(h.__value=e(S))==null?"":e(S)),z(ae,e(S))}),a(_e,h)}),a(w,C)},$$slots:{default:!0}}),a(N,U)},$$slots:{default:!0}}),a(d,y)},$$slots:{default:!0}});var Ve=i(Pe,4);nt(Ve,{fluid:!0,children:(d,u)=>{var y=ze(),X=I(y);{var r=W=>{var U=kt(),Y=i(I(U),2);lt(Y,()=>e(b),w=>E(b,w)),a(W,U)},N=(W,U)=>{{var Y=Z=>{var C=gt();a(Z,C)},w=Z=>{var C=Ut(),ee=i(I(C),2),_e=l(ee);s(ee);var S=i(ee,2),h=l(S),te=l(h);s(h);var ae=i(h,2),Fe=l(ae);s(ae);var Oe=i(ae,2),Ae=l(Oe);s(Oe),s(S);var je=i(S,2);_t(je,()=>e(j),n=>{var O=St(),R=i(I(O),2),A=l(R);s(R);var B=i(R,2);K(B,20,()=>Object.keys(e(j)),q=>q,(q,o)=>{var _=zt(),f=i(l(_)),k=l(f);s(f);var g=i(f);s(_),J(()=>{z(k,`${o??""}'s`),z(g,` static stack usage is
                    ${e(j)[o].max_static_stack_size-e(M)[o].max_static_stack_size} bytes -
                    now at ${e(j)[o].max_static_stack_size??""} / ${e(j)[o].max_stack_size??""}`)}),a(q,_)}),s(B),J(()=>z(A,`From ${t.selected_version??""} to ${t.selected_versions_to_compare??""} the change in...`)),a(n,O)});var pe=i(je,2),qe=l(pe);s(pe);var we=i(pe,2);Ne(we,{children:(n,O)=>{var R=wt(),A=I(R),B=l(A);K(B,21,()=>e(V).columns,o=>o.name,(o,_)=>{var f=Pt(),k=l(f),g=i(k);g.__click=[xt,V,_];var D=l(g);{var se=T=>{var re=$t(),ye=l(re);{var be=x=>{var oe=ne("↑");a(x,oe)},he=(x,oe)=>{{var ke=$=>{var le=ne("↓");a($,le)},ge=$=>{var le=ne("↕");a($,le)};H(x,$=>{e(V).getSortState(e(_).id)==="desc"?$(ke):$(ge,!1)},oe)}};H(ye,x=>{e(V).getSortState(e(_).id)==="asc"?x(be):x(he,!1)})}s(re),a(T,re)};H(D,T=>{e(V).isSortable(e(_).id)&&T(se)})}s(g),s(f),J(T=>{z(k,`${e(_).name??""} `),g.disabled=T},[()=>!e(V).isSortable(e(_).id)]),a(o,f)}),s(B),s(A);var q=i(A,2);K(q,21,()=>e(V).rows,o=>o.file+o.name,(o,_)=>{var f=jt();K(f,21,()=>e(V).columns,k=>k.name,(k,g)=>{var D=Ot(),se=l(D,!0);s(D),J(()=>z(se,e(_)[e(g).key])),a(k,D)}),s(f),a(o,f)}),s(q),a(n,R)},$$slots:{default:!0}});var ue=i(we,2),Je=l(ue);s(ue);var Ke=i(ue,2);Ne(Ke,{children:(n,O)=>{var R=Nt(),A=I(R),B=l(A);K(B,21,()=>e(F).columns,o=>o.name,(o,_)=>{var f=Tt(),k=l(f),g=i(k);g.__click=[Rt,F,_];var D=l(g);{var se=T=>{var re=Dt(),ye=l(re);{var be=x=>{var oe=ne("↑");a(x,oe)},he=(x,oe)=>{{var ke=$=>{var le=ne("↓");a($,le)},ge=$=>{var le=ne("↕");a($,le)};H(x,$=>{e(F).getSortState(e(_).id)==="desc"?$(ke):$(ge,!1)},oe)}};H(ye,x=>{e(F).getSortState(e(_).id)==="asc"?x(be):x(he,!1)})}s(re),a(T,re)};H(D,T=>{e(F).isSortable(e(_).id)&&T(se)})}s(g),s(f),J(T=>{z(k,`${e(_).name??""} `),g.disabled=T},[()=>!e(F).isSortable(e(_).id)]),a(o,f)}),s(B),s(A);var q=i(A,2);K(q,21,()=>e(F).rows,o=>o.file+o.name,(o,_)=>{var f=Lt();K(f,21,()=>e(F).columns,k=>k.name,(k,g)=>{var D=It(),se=l(D,!0);s(D),J(()=>z(se,e(_)[e(g).key])),a(k,D)}),s(f),a(o,f)}),s(q),a(n,R)},$$slots:{default:!0}}),J((n,O,R)=>{z(_e,`From ${t.selected_version??""} to ${t.selected_versions_to_compare??""} the change in...`),z(te,`...flash/code size is ${n??""} bytes`),z(Fe,`...static RAM size is ${O??""} bytes`),z(Ae,`...stack size is ${R??""} bytes`),z(qe,`Function symbols for ${t.selected_version??""}`),z(Je,`Variable symbols for ${t.selected_version??""}`)},[()=>Object.values(e(L)).filter(n=>n.d_size&&n.type==="function").reduce((n,O)=>n+O.d_size,0),()=>Object.values(e(L)).filter(n=>n.d_size&&n.type==="variable").reduce((n,O)=>n+O.d_size,0),()=>Object.values(e(L)).filter(n=>n.d_stack).reduce((n,O)=>n+O.d_stack,0)]),a(Z,C)};H(W,Z=>{t.selected_version?Z(w,!1):Z(Y)},U)}};H(X,W=>{!t.elfDataProvided&&e(b)&&!e(b)[0]?W(r):W(N,!1)})}a(d,y)},$$slots:{default:!0}}),s(fe),a(P,fe),st()}rt(["click"]);export{Gt as component,Bt as universal};
